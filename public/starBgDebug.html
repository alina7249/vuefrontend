<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>星空背景调试</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: #333;
      min-height: 100vh;
      overflow-x: hidden;
      background: transparent !important;
    }
    
    .debug-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10;
    }
    
    h1 { color: #2A5C8C; text-align: center; }
    h2 { color: #1A365D; margin-top: 20px; }
    
    .debug-info {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    
    /* 星空背景CSS样式 - 直接从项目中复制 */
    .star-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      opacity: 1;
    }
    
    .star-bg svg {
      width: 100%;
      height: 100%;
      background-color: rgba(42, 92, 140, 0.05);
      background-blend-mode: overlay;
    }
    
    .star-big {
      fill: #D4AF37;
      opacity: 0.7;
    }
    
    .star-small {
      fill: #FFFFFF;
      opacity: 0.5;
    }
    
    .star-bg-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(240, 242, 245, 0.1);
      opacity: 1;
      pointer-events: none;
      z-index: 0;
    }
    
    /* 测试按钮 */
    .test-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }
    
    button {
      padding: 8px 16px;
      background: #2A5C8C;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    button:hover {
      background: #1A365D;
    }
    
    /* 响应式测试样式 */
    @media (max-width: 767px) {
      .star-bg svg { transform: scale(1); } /* 不缩放，保持原始大小 */
    }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>星空背景调试页面</h1>
    <p>这个页面用于调试星空背景不显示的问题。打开控制台查看详细日志。</p>
    
    <div class="test-buttons">
      <button onclick="testStarBackground()">测试星空背景</button>
      <button onclick="checkDOM()">检查DOM结构</button>
      <button onclick="increaseStarSize()">增大星点大小</button>
      <button onclick="changeStarColor()">更改星点颜色</button>
    </div>
    
    <h2>调试信息</h2>
    <div id="debugLog" class="debug-info">加载中...</div>
  </div>
  
  <script>
    // 日志输出函数
    const debugLog = document.getElementById('debugLog');
    function log(message) {
      console.log('[星空背景调试]', message);
      debugLog.textContent += `\n${message}`;
      debugLog.scrollTop = debugLog.scrollHeight;
    }
    
    // 清空日志
    function clearLog() {
      debugLog.textContent = '';
    }
    
    // 生成星空背景SVG并直接创建SVG元素
    function generateStarBackground(width, height, starDensity = 100) {
      log(`generateStarBackground调用参数: width=${width}, height=${height}, starDensity=${starDensity}`);
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('width', width);
      svg.setAttribute('height', height);
      svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      log('SVG元素已创建');
      
      // 使用固定数量的星点以确保可见性
      const totalStars = 200; // 固定生成200个星点
      log(`生成星点总数: ${totalStars}`);
      
      // 大星点（浅金）占30%，小星点（纯白）占70%
      const bigStarCount = Math.floor(totalStars * 0.3);
      const smallStarCount = totalStars - bigStarCount;
      log(`大星点: ${bigStarCount}, 小星点: ${smallStarCount}`);
      
      // 生成大星点（浅金，直径2px）
      for (let i = 0; i < bigStarCount; i++) {
        const cx = Math.random() * width;
        const cy = Math.random() * height;
        const opacity = 0.5 + Math.random() * 0.5; // 随机透明度0.5-1.0
        
        const star = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        star.setAttribute('cx', cx);
        star.setAttribute('cy', cy);
        star.setAttribute('r', '2');
        star.setAttribute('fill', '#D4AF37'); // 浅金
        star.setAttribute('opacity', opacity);
        star.setAttribute('class', 'star-big'); // 添加类名
        
        svg.appendChild(star);
      }
      
      // 生成小星点（纯白，直径1px）
      for (let i = 0; i < smallStarCount; i++) {
        const cx = Math.random() * width;
        const cy = Math.random() * height;
        const opacity = 0.3 + Math.random() * 0.7; // 随机透明度0.3-1.0
        
        const star = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        star.setAttribute('cx', cx);
        star.setAttribute('cy', cy);
        star.setAttribute('r', '1');
        star.setAttribute('fill', '#FFFFFF'); // 纯白
        star.setAttribute('opacity', opacity);
        star.setAttribute('class', 'star-small'); // 添加类名
        
        svg.appendChild(star);
      }
      
      log('星点生成完成');
      return svg; // 直接返回SVG元素而不是字符串
    }
    
    // 初始化星空背景
    function initStarBackground() {
      log('开始初始化星空背景');
      
      // 检查并移除已存在的星空容器
      const existingStarBg = document.querySelector('.star-bg');
      const existingOverlay = document.querySelector('.star-bg-overlay');
      if (existingStarBg) {
        log('移除已存在的星空容器');
        document.body.removeChild(existingStarBg);
      }
      if (existingOverlay) {
        log('移除已存在的星空覆盖层');
        document.body.removeChild(existingOverlay);
      }
      
      // 创建星空背景容器
      const starBgContainer = document.createElement('div');
      starBgContainer.className = 'star-bg';
      
      // 创建星空覆盖层
      const starBgOverlay = document.createElement('div');
      starBgOverlay.className = 'star-bg-overlay';
    
      // 添加到body
      document.body.appendChild(starBgContainer);
      document.body.appendChild(starBgOverlay);
      log('星空容器和覆盖层已添加到body');
      
      // 根据屏幕尺寸生成星空
      function createStars() {
        // 清空现有星空
        starBgContainer.innerHTML = '';
        log('清空现有星空');
        
        // 获取屏幕尺寸
        const width = window.innerWidth;
        const height = window.innerHeight;
        log(`屏幕尺寸: ${width}x${height}`);
        
        // 根据设备类型调整星点密度
        let starDensity = 100; // 默认密度
        
        if (window.innerWidth <= 767) {
          // 移动端：星点密度降低40%
          starDensity = 60;
          log('检测到移动端，星点密度设置为60%');
        } else if (window.innerWidth <= 1199) {
          // 平板端：星点密度降低20%
          starDensity = 80;
          log('检测到平板端，星点密度设置为80%');
        } else {
          log('检测到桌面端，星点密度设置为100%');
        }
        
        // 直接生成并添加星空SVG元素
        try {
          const svgElement = generateStarBackground(width, height, starDensity);
          starBgContainer.appendChild(svgElement);
          log('星空SVG已添加到容器');
          
          // 检查SVG元素是否成功添加
          log(`SVG子元素数量: ${svgElement.children.length}`);
          
          // 记录第一个星点的信息
          if (svgElement.children.length > 0) {
            const firstStar = svgElement.children[0];
            log(`第一个星点信息: cx=${firstStar.getAttribute('cx')}, cy=${firstStar.getAttribute('cy')}, r=${firstStar.getAttribute('r')}, fill=${firstStar.getAttribute('fill')}, opacity=${firstStar.getAttribute('opacity')}`);
          }
        } catch (error) {
          log(`生成星空时出错: ${error.message}`);
          console.error(error);
        }
      }
      
      // 初始创建星空
      createStars();
      
      // 窗口大小改变时重新生成星空
      window.addEventListener('resize', () => {
        log('窗口大小改变，准备重新生成星空');
        // 使用防抖函数避免频繁重绘
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(() => {
          log('执行窗口大小改变后的星空重绘');
          createStars();
        }, 200);
      });
      
      log('星空背景初始化完成');
    }
    
    // 测试星空背景
    function testStarBackground() {
      clearLog();
      log('===== 开始星空背景测试 =====');
      log(`当前时间: ${new Date().toLocaleTimeString()}`);
      log(`浏览器: ${navigator.userAgent}`);
      log(`屏幕尺寸: ${window.innerWidth}x${window.innerHeight}`);
      
      // 检查body和html的样式
      const bodyStyle = window.getComputedStyle(document.body);
      const htmlStyle = window.getComputedStyle(document.documentElement);
      log(`body背景: ${bodyStyle.backgroundColor}, 透明度: ${bodyStyle.opacity}`);
      log(`html高度: ${htmlStyle.height}, body高度: ${bodyStyle.height}`);
      
      // 初始化星空背景
      initStarBackground();
    }
    
    // 检查DOM结构
    function checkDOM() {
      clearLog();
      log('===== 检查DOM结构 =====');
      
      const starBg = document.querySelector('.star-bg');
      const overlay = document.querySelector('.star-bg-overlay');
      
      if (starBg) {
        log('找到星空背景容器');
        const starBgStyle = window.getComputedStyle(starBg);
        log(`星空容器样式: position=${starBgStyle.position}, z-index=${starBgStyle.zIndex}, opacity=${starBgStyle.opacity}, width=${starBgStyle.width}, height=${starBgStyle.height}`);
        
        const svgElement = starBg.querySelector('svg');
        if (svgElement) {
          log('找到SVG元素');
          const svgStyle = window.getComputedStyle(svgElement);
          log(`SVG样式: width=${svgStyle.width}, height=${svgStyle.height}, background=${svgStyle.backgroundColor}, opacity=${svgStyle.opacity}`);
          log(`SVG星点数量: ${svgElement.children.length}`);
        } else {
          log('未找到SVG元素');
        }
      } else {
        log('未找到星空背景容器');
      }
      
      if (overlay) {
        log('找到星空覆盖层');
        const overlayStyle = window.getComputedStyle(overlay);
        log(`覆盖层样式: z-index=${overlayStyle.zIndex}, background=${overlayStyle.backgroundColor}, opacity=${overlayStyle.opacity}`);
      } else {
        log('未找到星空覆盖层');
      }
      
      // 检查其他可能影响的样式
      const allElements = document.querySelectorAll('*');
      let blockingElements = 0;
      
      allElements.forEach((el, index) => {
        if (index > 100) return; // 只检查前100个元素
        
        const style = window.getComputedStyle(el);
        const zIndex = parseInt(style.zIndex);
        const position = style.position;
        const background = style.backgroundColor;
        
        // 检查可能遮挡星空的元素
        if (position === 'fixed' && zIndex <= 0 && background !== 'rgba(0, 0, 0, 0)') {
          blockingElements++;
          log(`可能遮挡星空的元素: ${el.className || el.tagName}, z-index=${zIndex}, background=${background}`);
        }
      });
      
      log(`找到${blockingElements}个可能遮挡星空的元素`);
    }
    
    // 增大星点大小（便于调试）
    function increaseStarSize() {
      clearLog();
      log('===== 增大星点大小 =====');
      
      const svgElement = document.querySelector('.star-bg svg');
      if (svgElement) {
        // 增大所有星点的大小
        const stars = svgElement.querySelectorAll('circle');
        stars.forEach(star => {
          const currentR = parseFloat(star.getAttribute('r'));
          const newR = currentR * 5; // 增大5倍
          star.setAttribute('r', newR);
          star.setAttribute('fill', '#FF0000'); // 改为红色
          star.setAttribute('opacity', '1'); // 设置为完全不透明
        });
        log(`已将${stars.length}个星点增大5倍并改为红色`);
      } else {
        log('未找到SVG元素，请先初始化星空背景');
      }
    }
    
    // 更改星点颜色（便于调试）
    function changeStarColor() {
      clearLog();
      log('===== 更改星点颜色 =====');
      
      const svgElement = document.querySelector('.star-bg svg');
      if (svgElement) {
        // 更改所有星点的颜色为鲜艳颜色
        const stars = svgElement.querySelectorAll('circle');
        const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
        
        stars.forEach((star, index) => {
          const colorIndex = index % colors.length;
          star.setAttribute('fill', colors[colorIndex]);
          star.setAttribute('opacity', '1'); // 设置为完全不透明
        });
        
        log(`已将${stars.length}个星点更改为鲜艳颜色`);
      } else {
        log('未找到SVG元素，请先初始化星空背景');
      }
    }
    
    // 页面加载完成后自动测试
    window.addEventListener('load', () => {
      setTimeout(() => {
        testStarBackground();
      }, 1000);
    });
  </script>
</body>
</html>